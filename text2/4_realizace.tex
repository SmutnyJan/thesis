% (f) Popis implementace/realizace produktu se zaměřením na nestandardní části řešení.

\chapter{Realizace}
% Popis implementace/realizace se zaměřením na nestandardní části řešení.
% Architektonické obrázky. (class diagram asi ne)
Během implementace se objevila celá řada zádrhelů, z nichž většina souvisela s doposud ne zcela zdokumentovanými a odlazenými technologiemi, přesto byla velmi přínosná -- neustálým hledáním různých řešení a alternativ jsem nutně narazil na mnoho dalších zajímavých věcí. Kapitola se zabývá volbou použitých technologií, finální implementací a problémy, které se objevily v průběhu.

\section{Serverová aplikace}


\subsection{Použité technologie}
Mnoho použitých technologií bylo dáno zadáním práce, byl mi tak do značné míry usnadněn jejich výběr. Na druhou stranu nejsou dané technologie dokonalé, takže by často bývala práce s jinými snazší.

Celá serverová aplikace je napsána v \emph{JavaScriptu}, zprovozněna na \emph{Node.js}, datovým úložištěm se stalo \emph{MongoDB}.

\subsubsection{JavaScript}
Využití \emph{JavaScriptu} bylo pro svoje pravděpodobné vzrůstající nasazení v budoucnosti a své specifické vlastnosti dáno jako nefunkční požadavek.

\subsubsection{Node.js}
\emph{Node.js} (\url{http://nodejs.org/}) je platforma postavená nad běhovým prostředím JavaScriptu z Chrome. Slouží ke tvorbě rychlých, škálovatelných síťových aplikací. Node.js využívá událostmi řízený neblokovací I/O model, který ho činí nenáročným a efektivním, vhodným pro datově náročné \textit{real-timové} aplikace běžící v distribuovaném prostředí \cite{Node}.

Mimo standardního JavaScriptu lze v Node.js využívat i specifická rozšíření a množství modulů třetích stran. Z těch jsem využil:
\begin{itemize}
 \item \emph{date-utils} (\url{https://github.com/JerrySievert/node-date-utils}) -- mikro framework doplňující funkcionalitu JavaScriptového objektu Date. Zvažováno bylo i použití \emph{dateformat} (\url{https://github.com/felixge/node-dateformat}), ten je ale pro projekt méně vhodný. Oba moduly jsou stále ve vývoji.
 \item \emph{express} (\url{http://expressjs.com/}) -- renomovaný framework pro tvorbu webových aplikací založený na middleware frameworku \emph{connect} (\url{http://www.senchalabs.org/connect/}).
 \item \emph{iCalendar} (\url{https://github.com/tritech/node-icalendar}) -- knihovna pro práci s formátem iCalendar. Modul je stále ve vývoji. Zvažovány byly i další knihovny, například \emph{ical} (\url{https://github.com/peterbraden/node-ical}), ty ale implementovaly ještě méně možností, než použitá.
 \item \emph{iconv} (\url{https://github.com/bnoordhuis/node-iconv}) -- knihovna pro obsluhu systémového příkazu iconv sloužícímu k převádění kódování.
 \item \emph{jquery} (\url{https://github.com/coolaj86/node-jquery}) -- wrapper umožňující využít renomovanou JavaScriptovou knihovnu \emph{jQuery} (\url{http://jquery.com/}) v prostředí Node.js. Je zde využit \emph{jsdom} (\url{https://github.com/tmpvar/jsdom}) -- JavaScriptová implementace DOM.
 \item \emph{rdfstore} (\url{https://github.com/antoniogarrote/rdfstore-js}) -- JavaScriptová implementace \emph{\glsname{RDF}} grafového úložiště s podporou pro \emph{\glsname{SPARQL}}. Data mohou být (a v implementaci \glsname{DP} jsou) persistentně ukládána prostřednictvím Node.js modulu-ovladače \emph{mongodb} (\url{https://github.com/christkv/node-mongodb-native}) do NoSQL databáze \emph{MongoDB} (\url{http://www.mongodb.org/}). Modul je stále ve vývoji.
 \item \emph{soap} (\url{https://github.com/milewise/node-soap}) -- \todo{Pouze pokud se objeví podpora poskytnutého WSDL.}
\end{itemize}

Použití Node.js bylo vynuceno nefunkčním požadavkem, jednalo se ale o velmi cennou zkušenost -- je novou technologií a ačkoliv je jeho dokumentace na slušné úrovni, není zatím vytvořena dostatečně velká báze příkladů a nejlepších praktik, takže jsem se k nim musel postupně dostat a při té příležitosti se toho hodně naučil. Navíc, zdá se, se budou nabité vědomosti v budoucnu hodit.

\subsubsection{MongoDB}
\emph{MongoDB} (\url{http://www.mongodb.org/}) je škálovatelnou, vysoce výkonnou, otevřenou NoSQL databází napsanou v C++ \cite{Mongo}.

\subsection*{ }
Celé prostředí serverové aplikace je umístěno v serverové edici \glsname{GNU}/linuxové distribuce \emph{Ubuntu} (\url{http://www.ubuntu.com/}) a ta je pro snadnou přenositelnost nainstalována do kontejneru virtuálního stroje virtualizačního řešení \emph{VirtualBox} (\url{http://www.virtualbox.org/}).

\subsection{Použité nástroje}

% \subsection{Ideální implementace}


% \subsection{Finální implementace}


\section{Mobilní aplikace}
Pod pojmem \textit{mobilní aplikace} se skrývá aplikace pevně nezávislá na výše uvedené \textit{serverové}. Jejím hlavním cílem je sloužit studentovi \glsname{FIT} \glsname{CVUT} jako průvodce, zároveň má ale plnit i účel ukázky využití \glsname{SPARQL} endpointu vytvořeného v \textit{serverové} části.


\subsection{Struktura aplikace}


\subsection{Řešené problémy}

\subsubsection{Změna velikosti displeje}
chrome css v px

\subsubsection{Chyby prohlížečů v implementaci specifikací}
Při práci jsem několikrát narazil na situaci, kdy vše v jednom prohlížeči fungovalo, ve druhém nikoliv, a přesto bylo vše implementované správně podle specifikace. V takovém případě pak bývala chyba na straně prohlížeče, který špatně implementoval určitou specifikaci. Situace nastávala převážně u hodně specifických případů. Příkladem může být chybějící podpora pro nastavení transformace \glsname{SVG} elementu JavaScriptem v prohlížeči Google Chrome \cite{BugChromeTran}, tento problém ale lze obejít vlastním sestavením hodnoty celého atributu. 

\subsubsection{Rozdílné DOM u HTML a SVG}
\glsname{SVG} je, co se týče návrhu \glsname{DOM}, komplikovanější, než HTML -- zatímco u HTML stačí pro přístup k hodnotě atributu 

\subsubsection{Zpracování Cross-Origin zdrojů}
\label{sec:cross-origin}


\subsection{Použité technologie}
Níže uvádím soupis použitých technologií s odůvodněním, proč byly vybrány a v jakém kontextu použity.

\subsubsection{HTML5}
Většina technologií tvořících mobilní aplikaci by se dala zahrnout do pojmu HTML5 (myšlen význam v širším smyslu). Pomocí JavaScriptu se manipuluje s \glsname{HTML} strukturou, které je prezentována za pomocí \glsname{CSS}, klíčová část aplikace -- mapa -- je tvořena \glsname{SVG} (o tom ještě dále). T

\subsubsection{SVG}
Mapa použitá v aplikaci je implementována prostřednictvím \glsname{SVG}. Rozhodnutí bylo učiněno na základě identifikace a porovnání možných technologií:
\begin{itemize}
 \item Statické obrázky s předgenerovanými proměnnými částmi.
 \item Statické obrázky s dynamicky pozicovanými proměnnými částmi.
 \item Dynamicky kreslené obrázky na \textit{canvas}.
 \item Statické \glsname{SVG} s dynamickými úpravami.
\end{itemize}

První zmíněné řešení bylo zavrženo kvůli nízké flexibilitě -- není možné dopředu vygenerovat všechny varianty obrázků, které by pokrývaly možné situace -- i kdyby to možné bylo, množství obrázků by bylo velmi vysoké\footnote{Pro pokrytí všech situací by byly třeba zvlášť obrázky s vyznačením kterékoliv místnosti, kteréhokoliv bodu zájmu, kterékoliv výchozí pozice\dots Vzhledem k rozsáhlosti mapy by tak počet obrázků byl enormní.} a pro omezenou paměťovou kapacitu cílových zařízení nevhodné.

Druhý přístup, dynamické pozicování, byl zavržen z důvodů optimalizací rozvržení prvků mobilními prohlížeči -- není zaručené, že se prvek (například ukazatel nalezené místnosti) skutečně umístí, kam má.

Nová vlastnost HTML5, kreslení prostřednictvím JavaScriptu na \textit{canvas} element, byla, narozdíl od předchozích možností, zvažována až do finálního rozhodnutí -- ačkoliv se jedná o řešení čistě v režii již používaných technologií (JavaScript, HTML), jeho využití jsem z několika důvodů zavrhl:
\begin{itemize}
 \item Neumožňuje nakreslený obrázek nijak upravit (například posunout ukazatel na mapě), ale musí se vždy překreslit, což je náročnější na zdroje.
 \item Kvůli principu dynamického generovaní obrázků JavaScriptem nelze kostru připravit pomocí běžných grafických editorů.
 \item Subjektivně mi přijde práce s mapou jako \glsname{SVG} obrázkem reprezentovaným \glsname{XML} dokumentem majícím \glsname{DOM} přehlednější, než s méně strukturovatelným JavaScriptem.
\end{itemize}

Reprezentaci mapy jsem tedy svěřil \glsname{SVG} z následujících důvodů:
\begin{itemize}
 \item Snadné vytvoření mapy prostřednictvím běžného grafického editoru.
 \item Možnost znovupoužití mapy standardního grafického formátu i v jiných projektech.
 \item Práce s mapou (něpř. vyznačování pozic) se provádí pouhodou úpravou jejího \glsname{DOM}.
 \item I po úpravách se stále jedná o týž objekt -- není nutné ho překreslovat.
\end{itemize}

Nutno podotknout, že jsou implementace kreslení na \textit{canvas} a \glsname{SVG} na různých mobilních zařízeních na různých úrovních, ani jedna ovšem nemá výrazně navrch \cite{CanIUse} \cite{MobileHtml}.

\subsubsection{PHP}
Z důvodů popsaných v podsekci \ref{sec:cross-origin} (str. \pageref{sec:cross-origin}) bylo nutné vytvořit podpůrnou serverovou aplikaci -- proxy. Po úvaze jsem se rozhodl pro využití jazyka \glsname{PHP}, který je podporovaný jako jediný nástroj pro tvorbu dynmického obsahu na fakultním webovém serveru \url{http://webdev.fit.cvut.cz/}. Tuto kombinaci, vzhledem k její podpoře ze strany fakulty a určení práce pro fakulní nasazení, považuji i přes jinde využitý JavaScript za vhodnou.


\subsection{Použité knihovny}

\subsubsection{jQuery}
A

\subsubsection{HTML Purifier}
Po několika vlastních implementacích nástroje na pročištění a ošetření \glsname{HTML} vstupů pocházejících od třetích stran jsem sáhl k implementaci již prověřené -- oblast ošetření aplikace před škodlivými vstupy má z hlediska bezpečnosti vysokou prioritu a neustále se objevující nové hrozby nakonec vedly k tomu, že jsem se rozhodl nespoléhat na své vlastní implementace a využít \textit{know-how} tvůrců svobodné \glsname{PHP} knihovny  HTML Purifier (\url{http://htmlpurifier.org/}) -- ta odstraní případná nebezpečí za využití pokročilého auditovaného \textit{whitelistu} a v případě potřeby navíc zajistí validitu kódu. Knihovna je využita v rámci proxy zmíněné v předchozím odstavci.


\subsection{Použité nástroje}
Pro tvorbu aplikace byly použity převážně následující nástroje. Majorita jich je uvolněných pod svobodmými licencemi, zpravidla \glsname{GNU} \glsname{GPL} nebo kompatibilními. Jedinou výjimkou jsou některé mobilní prohlížeče, které byly použity k testování aplikace.

\subsubsection{Kate}
Většina práce, včetně mobilní aplikace, byla vytvořena v textovém editoru \glsname{Kate} (\url{http://kate-editor.org/}). Jedná se o velmi pokročilý nástroj pro práci s textem z prostředí \glsname{GNU}/Linuxového desktopového prostředí \glsname{KDE}. \glsname{Kate} nabízí zvýrazňování syntaxe všech v diplomové práci použitých formátů, poskytuje velmi užitečnou práci s regulárními výrazy, umožňuje pracovat s mnoha soubory najednou a, co je asi nejpodstatnější, plně se integruje do \glsname{KDE}, takže ním například lze prostřednictvím \gls{KIO} transparentně pracovat se vzdálenými soubory. \glsname{Kate} neumožňuje automatické doplňování kódu, nabízí ale již použitá slova kdekoliv v dokumentu, což je vlastnost v některých případech i lepší. Kate byl zvolen na základě velice kladných zkušeností pro napsání kódu v JavaScriptu, \gls{HTML}, \gls{CSS} i úpravy mapy v \gls{SVG}.

\subsubsection{Inkscape}
Grafické podklady práce byly vytvořeny v editoru vektorové grafiky Inkscape (\url{http://www.inkscape.org/}). Nástroj implementuje téměř kompletní specifikaci formátu \glsname{SVG} verze 1.1, je multiplatformní a svobodný. Inkscape byl vybrán kvůli předchozím výborným zkušenostem s prací v něm a vhodnosti pro tvorbu mapových podkladů.

\subsubsection{Kompare}
V případě potřeby důkladného porovnání souborů byl použit Kompare (\url{http://www.caffeinated.me.uk/kompare/}). Nástroj umožňuje velmi přehledně porovnat mimo jednotlivých souborů i celé jejich adresáře. Kompare neporovnává soubory sám, ale je nadstavbou nad konzolovou aplikací diff či obdobnou.

\subsubsection{Webové prohlížeče}
Aplikace byla průběžně testována v různých mobilních prohlížečích:
\begin{itemize}
 \item Mozilla Firefox (\url{http://www.mozilla.org/firefox}).
 \item Chromium (\url{http://chromium.org/}).
 \item rekonq (\url{http://rekonq.kde.org/}).
 \item Prohlížeč platformy Android (\url{http://www.android.com/}).
 \item Google Chrome for Android (\url{https://www.google.com/intl/en/chrome/android/}).
 \item Opera Mobile (\url{http://www.opera.com/mobile}).
 \item Internet Explorer Mobile (\url{http://www.microsoft.com/windowsphone/en-us/features/default.aspx#internet-explorer}).
Před dokončením byla navíc otestována panem inženýrem Havrylukem, vedoucím práce, v následujících prohlížečích:
 \item Nokia Browser for Symbian  (\url{http://browser.nokia.com/}).
 \item Prohlížeč platformy BlackBerry (\url{http://us.blackberry.com/smartphones/features/internet.jsp}).
 \item Safari (\url{http://www.apple.com/safari/}).
\end{itemize}

\subsubsection{Git}
Práce byla průběžně verzována systémem pro správu verzí Git (\url{http://git\-scm.com/}), čímž bylo zajištěné pohodlné zálohování jak ve smyslu možnosti návratu k některé z minulých verzí, tak i ve smyslu vzdáleného duplikování na serveru GitHub (\url{http://github.com/}). Pozitivním vedlejším efektem tohoto přístupu je možnost sledování vývoje prostřednictvím veřejného repozitáře.


\subsection{Ideální implementace}
Finální implementace se od té ideální, co se týče omezení vzniklých neideálním světem, moc neliší. Vzhledem k cílení aplikace na současná nová zařízení bylo možné realizovat téměř vše, co bylo naplánováno -- v uplynulých letech bylo odvedeno mnoho práce na jednotných standardech napříč zařízeními, a co víc, tyto standardy byly implementovány a z velké části se i dodržují. Problémy se proto vyskytly spíše na poli stále ještě v některých ohledech omezených možnostech mobilních zařízení.

\subsubsection{Malá velikost displeje}
Ačkoliv je toto omezení u mobilních zařízení zřejmé, nic to nemění na faktu, že se s ním musí neustále počítat a je třeba vybírat vhodné komponenty a ty vhodně rozvrhovat. Mým cílem proto bylo vizualizovat jen to nejnutnější.

\subsubsection{Různé typy polohovacích zařízení}
Různá zařízení poskytují různé ovládací prvky využívající různé principy, aplikaci je ale nutné přizpůsobit pro všechny najednou. Jiné je ovládání pro myš (touchpad, trackpad), jiné pro klávesy a jiné pro dotyková zařízení. I přes malý displej je třeba u mobilních dotykových zařízení vytvářet ovládací prvky natolik veliké, aby bylo možné je používat prsty.

\subsubsection{Optimalizace rozvržení prvků}
Mobilní zařízení nabízejí pro lepší využití malých displejů mnoho různých otimalizací rozvržení zobrazovaných prvků. Zpravidla jsou tyto vlastnosti velmi užitečné -- komprimují nevyužité místo, ve specifických případech, jako je třeba přesné pozicování ukazatele, ale může docházet k obtížně řešitelným situacím. Jediné místo aplikace, které se bez přesného rozmístění neobejde, jsou mapy. Problém jsem se nakonec rozhodl řešit využitím  \glsname{SVG} mapových podkladů, ve kterých prohlížeče, zdá se, zatím rozvržení neoptimalizují.

\subsubsection{Implementace SVG}
Implementace \glsname{SVG} je v desktopových prohlížečích na velmi dobré úrovni již nějakou dobu,\footnote{Posledním významným desktopovým prohlížečem podporujícím \glsname{SVG} se stal s dlouhým odstupem verzí 9.0 Internet Explorer \cite{CanIUse}, předtím pro něj ale byly dostupné vhodné pluginy.} v nedávné minulosti se ale podpora značně zlepšila i na poli mobilních zařízení \cite{CanIUse}.

U mobilních zařízení nepřekvapuje chybějící implementace některých neklíčových možností \glsname{SVG}, jako je třeba průhlednost v případě Opery Mobile. V této oblasti v současné době rozsáhlému nasazení nepřeje \glsname{SVG} nepodporující hojně využívaný nativní webový prohlížeč Androidu verze 2, od verze 3 je podpora zavedena. Problém lze obejít využitím jiného dostupného prohlížeče.

Překvapením byla pomalá, ačkoliv jinak velmi rozsáhlá, implementace \glsname{SVG} v prohlížeči Mozilla Firefox -- po některých operacích, v mém případě to byla třeba změna hodnot atributu \texttt{viewBox} \glsname{SVG} elementu (posunutí mapy), prohlížeč vyžaduje překreslení celého obrázku, což je velmi zdlouhavé a zabraňuje to plynulému posunu mapy z aktuální na novou pozici, byť by to bylo vhodné pro lepší uživatelovo zorientování se. Tento nedostatek je známý již delší dobu \cite{Bugzilla}.

\subsubsection{Absence popisků}
Velmi užitečnou vlastností dostupnou u desktopových aplikací jsou popisky zobrazující se po najetí myši nad podporovaný prvek. Dá se tímto způsobem velmi dobře implementovat kontextová nápověda, která patří mezi nejpodstatnější zdroje pomoci uživateli. U dotykových mobilních zařízení ale bohužel popisky zpravidla zobrazovat nejdou -- najetím, tedy dotykem prstu, se rovnou vyvolá akce prvku, aniž by se popisek mohl zobrazit.

\subsubsection{Dynamické načítání lokálních souborů}
Z bezpečnostních důvodů došlo v minulosti v prohlížečích k zamezení načítání JavaScriptových souborů z jiných zdrojů, než ze kterých stránka pochází. To v některých případech\footnote{Příkladem je Google Chrome.} přerostlo v zamezení dynamického načítání jakýchkoliv lokálních souborů -- jejich zdroj nemá žádnou hodnotu (\texttt{null}), takže je nelze načíst. Aby byla zachována možnost offline využití aplikace na větší skupině zařízení, byla aplikace přepsána na jediné možné řešení -- explicitní uvedení všech potenciálně vkládaných souborů, což značně omezilo modularitu aplikace.

\subsubsection{Otevírání lokálních souborů}
Omezení zmíněná v předchozím odstavci stupňuje až do extrémů mobilní prohlížeč Chrome Beta, který nepovolí ani přímé otevření lokálního souboru. \todo{Ověřit, možná nefunguje celé Chrome\dots}

% Vlivem různých omezení mobilních zařízení (viz sekce \ref{sec:omezeniZarizeni}) a prohlížečů (viz sekce \ref{sec:omezeniProhlizecu}) nevypadá finální implementace úplně tak, jak bylo zamýšleno, přesto zadání splňuje. Téměř už dokončená aplikace byla před nasazením otestována (viz sekce \ref{sec:testVTerenu}).
% 
% Samotná aplikace není nijak složitá, a proto ani její rozsah není příliš veliký. Je rozdělena do následujících čtyř souborů:
% \begin{itemize}
% \item \emph{index.html} -- hlavní soubor aplikace, volá ostatní; obsahuje statické údaje,
% \item \emph{data/db.js} -- databáze místností; stačí aktualizovat pouze tento soubor,
% \item \emph{data/script.js} -- veškerá logika aplikace,
% \item \emph{data/style.css} -- nastavení vzhledu aplikace.
% \end{itemize}
% K doplnění výčtu všech souborů patří ještě plány místností v adresáři \emph{data/maps/}.
% 
% \subsection{Vyhledávání}
% Vyhledávání je realizováno jako prototyp\footnote{Pozor, nejedná se o prototyp ve smyslu zkušebního řešení, ECMAScript prototypem nazývá rozšíření stávajícího objektu.} pole. Parametrem funkce je hledaný řetězec, ten se převede na ECMAScriptový regulární výraz a tím se zkontroluje každá položka prohledávaného pole. Funkce vrátí buď pole nalezených indexů nebo \texttt{false} v případě, že byl hledaný výraz špatně sestaveným regulárním výrazem. Názvy místností se speciálními znaky regulárních výrazů nekolidují, takže k špatnému sestavení výrazu v praxi často nedochází.
% \begin{verbatim}
% Array.prototype.find = function (searchStr) {
%   var returnArray = [];
%   var regExp;
%   //zpracování špatně sestaveného regulárního výrazu
%   try {
%     regExp = new RegExp(searchStr, 'i');
%   } catch (error) {
%     return false;
%   }
%   for (var i = 0; i < this.length; i++) {
%     if (regExp.test(this[i])) {
%       returnArray.push(i);
%     }
%   }
%   return returnArray;
% }
% \end{verbatim}
% 
% \subsection{Změna obrazovky}
% Pro umožnění odskočit si z vyhledávání do nápovědy a po návratu mít ve vyhledávacím formuláři ty samé údaje je potřeba, aby si aplikace udržela v paměti některá data, i když se přepne na jinou obrazovku. Běžně se používá pro každou obrazovku jiná HTML stránka, tam ale nedochází k podržení stavu.  Problém jsem vyřešil použitím jediné stránky, která obsahuje více \uv{obrazovek}, které se přepínají ECMAScriptem.
% \begin{verbatim}
% var recentlyDisplayedScreen = defaultScreen;
% var preRecentlyDisplayedScreen;
% function switchScreen(screen) {
%   if (!screen) screen = preRecentlyDisplayedScreen;
%   document.getElementById(recentlyDisplayedScreen).style.display = 'none';
%   document.getElementById(screen).style.display = 'block';
%   preRecentlyDisplayedScreen = recentlyDisplayedScreen;
%   recentlyDisplayedScreen = screen;
% }
% \end{verbatim}
% 
% \begin{verbatim}
% <div id="placesScreen" class="screen">
%   ...
%   <a href="#" onclick="switchScreen('helpScreen'); return false;">Nápověda</a></div>
%   ...
% </div>
% \end{verbatim}
% 
% \subsection{Rozvržení databáze}
% Databáze je optimalizována na nízký výkon mobilních zařízení, což spolu s faktem, že nelze použít objekty, které by držely související záznamy pospolu, vede k dost nepřehlednému řešení. Databáze je tvořena pěti poli:
% \begin{itemize}
% \item \texttt{placesAllMixed[]} -- Pole obsahující všechny vyhledatelné fráze a jejich verze s odstraněnou diakritikou. V tomto poli se vyhledává.
% \item \texttt{placesAssignement[]} -- Pole přiřazující nalezené frázi z pole \texttt{placesAllMixed[]} název místnosti a alternativ z pole \texttt{placesAlternate[]}.
% \item \texttt{placesAlternate[]} -- Pole obsahující oficiální název místnosti se všemi alternativami (starými názvy, sídlícími vyučujícími\dots).
% \item \texttt{placesImg[]} -- Pole obsahující názvy obrázků, ve kterých jsou uloženy plánky konkrétních místností. (Názvy mohou obsahovat i parametry, v budoucnu, až to implementace SVG v mobilních zařízeních dovolí, mohou záznamy vypadat:\\ \texttt{kn-e-1np?select=kn-e-9\&show=wc}.)
% \item \texttt{usedDiacritics[]} -- Pole obsahující v názvech místností obsažené znaky s diakritikou a jejich náhradu bez diakritiky - pole se nepoužívá při vyhledávání (zde by zpomalovalo zkoušení všech diakritických variant), ale až při zvýrazňování hledané fráze u~nalezených místností.
% \end{itemize}
% 
% \subsection{Našeptávání vyhledávání}
% Po každém stisku klávesy ve vyhledávacím formuláři se prohledá databáze. Aby nedocházelo ke zbytečným ztrátám na výkonu, aplikace kontroluje, jestli je zadaný výraz dlouhý alespoň dva znaky, protože listování všech výsledků trvá zbytečně dlouho, a také kontroluje, jestli nebyl odeslán ten samý výraz podruhé -- u desktopových prohlížečů by se asi nic takového nestalo, ale mobilní se většinou chovají tak, že počkají, až uživatel zadá celý text a~potvrdí ho, a~až poté teprve pro každou stisknutou klávesu vyvolají událost jejího stisknutí (viz problém \ref{subs:udalostiKlaves}). Stojí za to zmínit některé události, které se pro našeptávání hodí:
% \begin{itemize}
% \item Události vyvolané myší (dotykem) -- široce podporované, nepoužitelné ale z důvodu absence myši na většině mobilních zařízení.
% \item Change (změna elementu) -- téměř ideální událost, bohužel se vyvolá až po opuštění elementu, navíc nefunguje všude.
% \item Keypress (stisknutí a uvolnění klávesy) -- absence v iPhone, některé jiné prohlížeče nepodporují.
% \item Keydown (stisknutí klávesy) -- v některých prohlížečích nefunguje nebo vyvolává událost vícekrát.
% \item Keyup (uvolnění klávesy) -- funguje téměř všude, pro našeptávač je nejvhodnější událostí.
% \item Reset (nastavení na výchozí hodnoty) -- funguje téměř všude bez problémů, ale využití této události je pro dané účely nevhodné.
% \item Submit (odeslání formuláře) -- funguje téměř všude bez problémů, vyvolá ji ale až odeslání formuláře, v našeptávači může sloužit jako pojistka, když vyvolání nevyvolá žádná jiná událost.
% \end{itemize}
% Z výše uvedeného seznamu bohužel vyplývá, že není úplně univerzální řešení, kterým bychom se dozvěděli, že uživatel něco zadal a můžeme vyhledávat. Dobře zpracovaný přehled podpory událostí je na blogu QuirksMode \cite{EventCompatibility}.
% 
% \subsection{Aktualizace databáze}
% Ačkoliv to nemusí být pro uživatele ideální, databáze aplikace se nedokáže vlivem použitých technologií sama aktualizovat. Uživatel má ale i přesto tři docela uspokojující možnosti:
% \begin{itemize}
% \item Použití aplikace online -- pokud má v připojení k Internetu.
% \item Ruční aktualizace databáze -- stačí nahradit jediný soubor.
% \item Neaktualizovat -- rozvržení učeben a kanceláří se tak často nemění.
% \end{itemize}
% 
% \subsection{Stav implementace}
% Implementace obsahuje databázi místností a mapové podklady pouze pro první dvě podlaží budovy E na Karlově náměstí. S vedoucím práce jsme usoudili, že se jedná o reprezentativní vzorek a že by bylo kontraproduktivní obíhat jiné budovy s pásmem a tvořit jejich plány (k této byly plány dostupné).
% 
% Implementace nefunguje ve webovém prohlížeči Internet Explorer do verze 8. Prohlížeče Internet Explorer jsou známy nedodržováním standardů a vzhledem k jejich určení pro desktopy se nejedná o velikou ztrátu. Aplikace nefunguje bohužel ani v mobilní verzi prohlížeče Internet Explorer, to už je větší problém, naštěstí jsou na těchto zařízeních dostupné i jiné prohlížeče, které nemají s aplikací problém.\footnote{Všechny zařízení, které jsem viděl a měly v sobě mobilní verzi Internet Exploreru, měly nastavenou jako výchozí prohlížeč Operu Mobile.}
% 
% \subsection{Tvorba databáze}
% Ačkoliv to nebylo obsahem práce, vytvořil jsem jednoduchý PHP skript na tvorbu databáze místností, podstatně zjednodušuje i její správu. Skript je ale velmi naivní, neošetřuje vstupy a nenabízí tolik možností, kolik by bylo pro pohodlnou správu administrativním pracovníkem potřeba. Toto je jedna z oblastí, kde by se dalo v budoucnu pokračovat. Skript je přiložen na CD.
% 
% 
% 
% \section{Omezení mobilních zařízení}
% \label{sec:omezeniZarizeni}
% Následující sekce je zaměřena na některá omezení mobilních zařízení, na která jsem při práci narazil a musel je nějak vyřešit. Většina jich je spjatá s menší velikostí a mobilitou těchto zařízení. U každého omezení je uveden \emph{problém}, který činí; viník, který omezení \emph{způsobuje}; jaké by mohlo být \emph{řešení} a jakou má \emph{závažnost} -- ta se pro jednoduchost dělí pouze na vysokou, střední a nízkou.
% \subsection{Malá velikost displeje}
% \begin{description*}
% \item[Problém:] Velikost displeje neumožňuje vtěsnat potřebné množství informací na obrazovku.
% \item[Způsobuje:] Malý displej zařízení.
% \item[Řešení:] Současně žádné vhodné neexistuje. V budoucnosti se možná objeví skládací displeje a jiné technologie, které zachovají malou velikost zařízení, ale nabídnou větší zobrazovací plochu.
% \item[Závažnost:] Vysoká.
% \end{description*}
% 
% \subsection{Nízký výkon}
% \begin{description*}
% \item[Problém:] Zařízení mají malý výkon a nezvládají náročnější algoritmy.
% \item[Způsobuje:] Nízký výkon mobilních zařízení.
% \item[Řešení:] Je nutné nejen optimalizovat, ale také se omezit na méně náročné algoritmy. V~současné době navíc vývoj mobilních zařízení v oblasti výkonu natolik pokročil, že toto omezení přestává mít význam. Je jen otázkou času, kdy klesnou na ceně a rozšíří se.
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Špatná správa paměti}
% \begin{description*}
% \item[Problém:] Při načítání velké stránky dojde k zaplnění paměti a zatuhnutí telefonu.
% \item[Způsobuje:] Špatná implementace správy paměti (dáno pravděpodobně malými možnostmi mobilních zařízení).
% \item[Řešení:] Snažit se omezit paměťovou náročnost algoritmů a grafického rozhraní.
% \item[Závažnost:] Vysoká.
% \end{description*}
% 
% \section{Omezení mobilních prohlížečů}
% \label{sec:omezeniProhlizecu}
% Následující sekce je zaměřena na některá omezení testovaných prohlížečů. Ne pokaždé se tato omezení vztahují na mobilní prohlížeče a ne pokaždé jsou častá -- pro svou závažnost bylo zařazeno i několik výjimek. U každého omezení je uveden \emph{problém}, který činí; viník, který omezení \emph{způsobuje}; jakých prohlížečů se omezení \emph{týká}; jaké by mohlo být \emph{řešení} a jaká zůstane omezení \emph{závažnost}, pokud vezmeme v úvahu dostupná řešení. Testované prohlížeče v~položce \emph{týká se} jsou především Arora, BlackBerry Browser, Internet Explorer Mobile, Konqueror, Mozilla Firefox, NetFront Browser, Nokia Mini Map Browser, Opera Mini a~Opera Mobile. \emph{Závažnost} se pro jednoduchost dělí pouze na vysokou, střední a nízkou.
% \subsection{Prohlížeč neumí popisky}
% \begin{description*}
% \item[Problém:] Prohlížeč neumí zobrazovat popisky \texttt{title} elementů.
% \item[Způsobuje:] Absence pokročilých polohovacích zařízení v mobilních zařízeních, malé displeje a z toho plynoucí špatná použitelnost těchto popisků.
% \item[Týká se:] Téměř každého mobilního prohlížeče.
% \item[Řešení:] Řešením by mohlo být si pomocí HTML a ECMASctiptu vytvořit vlastní popisky, v tomto prostředí je ale lepší absenci popisků přizpůsobit design a vůbec je nepoužívat.
% \item[Závažnost:] Nízká.
% \end{description*}
% 
% \subsection{Nestandardní implementace událostí kláves}
% \label{subs:udalostiKlaves}
% \begin{description*}
% \item[Problém:] Text se často zadává místo rovnou do formuláře někam stranou a nedají se pak odchytávat události stisknutí jednotlivých kláves. Pokud je v prohlížeči vyvolána událost stisknutí klávesy, děje se tak až po odeslání celého textu.
% \item[Způsobuje:] Nestandardní implementace -- v mobilním prostředí přináší výhody, uživatel může zadávat text způsoby, kterými je zvyklý z jiných míst zařízení.
% \item[Týká se:] Téměř každého mobilního prohlížeče.
% \item[Řešení:] Řešení neexistuje, dá se ale spokojit s událostí stisku klávesy vyvolanou po zadání celého textu.
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Absence kurzoru}
% \begin{description*}
% \item[Problém:] Prohlížeče umožňují aktivovat pouze určité oblasti, zpravidla odkazy; neumožňují použití obrázkových map a odchytávávání událostí vyvolaných kliknutím na jiné elementy.
% \item[Způsobuje:] Absence kurzoru (nebo použití jiného ukazatele -- např. prstu) nebo jeho omezený pohyb.
% \item[Týká se:] Téměř každého mobilního prohlížeče.
% \item[Řešení:] Řešení neexistuje, dá se zčásti obejít vhodným návrhem.
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Zmenšování obrázků}
% \begin{description*}
% \item[Problém:] Ve výchozím nastavení prohlížeče optimalizují (mj.) velikosti obrázků pro malé displeje a neumožňují tím pádem zobrazovat obrázky ve větším rozlišení.
% \item[Způsobuje:] Optimalizace velikosti obrázků.
% \item[Týká se:] Téměř každého mobilního prohlížeče.
% \item[Řešení:] Řešení neexistuje, dá se někdy obejít -- v určitých případech odeslat místo celé HTML stránky samotný obrázek, některé prohlížeče mají implementované posouvání, zvětšování, ukládání a další funkce pro práci s obrázky.
% \item[Závažnost:] Vysoká.
% \end{description*}
% 
% \subsection{Špatné škálování obrázků}
% \begin{description*}
% \item[Problém:] Prohlížeč při zadané maximální šířce obrázku nepřeškáluje v případě potřeby podle specifikace \cite{CssDoc} i výšku obrázku.
% \item[Způsobuje:] Chyba v implementaci CSS vlastnosti \texttt{max-width}.
% \item[Týká se:] Nokia Mini Map Browser, BlackBerry Browser.
% \item[Řešení:] Dalo by se obejít použitím hacků, které by ale nezaručily, že nezpůsobí chyby v~jiných, netestovaných prohlížečích.
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Optimalizace rozvržení obrázků}
% \label{subs:rozvrzeniObrazku}
% \begin{description*}
% \item[Problém:] Ve výchozím nastavení prohlížeče optimalizují (mj.) rozvržení obrázků pro malé displeje, čímž ale zároveň nastává přesouvání přesně rozvržených obrázků na špatná místa.
% \item[Způsobuje:] Optimalizace rozvržení obrázků.
% \item[Týká se:] Téměř každého mobilního prohlížeče.
% \item[Řešení:] Řešení neexistuje. Dá se obejít předgenerováním možných situací do jediných obrázků, pokud to omezená množina situací a velikost paměti zařízení dovolí.
% \item[Závažnost:] Vysoká.
% \end{description*}
% 
% \subsection{Nefunkčnost lokální URI s parametry}
% \begin{description*}
% \item[Problém:] Prohlížeč nedokáže rozpoznat parametry URI a považuje je za součást adresy, nemůže tím pádem nalézt požadované lokální soubory (na požadavek \texttt{index.html?var=val} nedokáže vrátit soubor \emph{index.html}).
% \item[Způsobuje:] Neimplementovaná práce s parametry lokální URI.
% \item[Týká se:] NetFront Browser.
% \item[Řešení:] Řešení neexistuje. V určitých případech se dá obejít chyba nenalezení souboru, například SVG obrázek se dá požadovat pomocí elementu \texttt{<object>} a parametry místo do~URI uvést do~vnořeného elementu \texttt{<param>}.
% \item[Závažnost:] Vysoká.
% \end{description*}
% 
% \subsection{Nefunkčnost ECMAScriptového skriptu s příponou \emph{es}}
% \begin{description*}
% \item[Problém:] Prohlížeč nedokáže zpracovat ECMAScriptový soubor se standardní příponou es.
% \item[Způsobuje:] Neimplementovaná podpora přípony es.
% \item[Týká se:] BlackBerry Browser.
% \item[Řešení:] Řešením, byť ne sémanticky dokonalým, je přejmenování přípony ECMAScriptu es na příponu JavaScriptu js.
% \item[Závažnost:] Nízká.
% \end{description*}
% 
% \subsection{V ECMAScriptových RegExpech chybí zpětná reference na celý výraz}
% \begin{description*}
% \item[Problém:] Prohlížeč neumí v regulárních výrazech zpětnou referenci na celý výraz -- \texttt{\$\&}.
% \item[Způsobuje:] Chyba v prohlížeči.
% \item[Týká se:] Nokia Mini Map Browser.
% \item[Řešení:] Obalení celého výrazu do závorek pro vytvoření zpětné reference. Referencuje se pomocí čísla -- \texttt{\$1} a ostatní zpětné reference se inkrementují.
% \item[Závažnost:] Nízká.
% \end{description*}
% 
% \subsection{V ECMAScriptových RegExpech nefunguje vyhledávání bez rozlišování velikosti písmen}
% \begin{description*}
% \item[Problém:] Prohlížeč neumí vyhledávat v regulárních výrazech bez rozlišování velikosti, pokud jsou zadána pouze malá písmena.
% \item[Způsobuje:] Chyba v prohlížeči.
% \item[Týká se:] Nokia Mini Map.
% \item[Řešení:] Žádné nenalezeno. Dá se obejít použitím jiného prohlížeče, na stejné platformě, jako Nokia Mini Map, funguje i Opera Mobile.
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Prohlížeč nepodporuje SVG obrázky}
% \begin{description*}
% \item[Problém:] Prohlížeč neumí zpracovat a zobrazit SVG obrázky.
% \item[Způsobuje:] SVG není implementované.
% \item[Týká se:] BlackBerry Browser.
% \item[Řešení:] Žádné nenalezeno. SVG lze nahradit i jinou technologií, například PNG obrázky, ztrácíme ale možnost znovupoužití částí SVG kódu, obrázky musíme mít pro každou situaci předgenerované a výrazně tak narůstá paměťová náročnost.
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Prohlížeč dynamicky nenačte SVG obrázky}
% \begin{description*}
% \item[Problém:] Prohlížeč neumí (pomocí ECMAScriptu) dynamicky zobrazit SVG obrázky.
% \item[Způsobuje:] Příčina se nepodařila zjistit, pravděpodobně se jedná o chybu nebo výkonnostní omezení prohlížeče.
% \item[Týká se:] NetFront Browser.
% \item[Řešení:] Žádné nenalezeno. SVG lze nahradit i jinou technologií, například PNG obrázky, ztrácíme ale možnost znovupoužití částí SVG kódu, obrázky musíme mít pro každou situaci předgenerované a výrazně tak narůstá paměťová náročnost.
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Prohlížeč neumí zpracovat ECMAScript uvnitř SVG obrázku}
% \begin{description*}
% \item[Problém:] Prohlížeč neumí zpracovat ECMAScript v obrázku a nedají se tím pádem například generovat plánky přímo za chodu aplikace.
% \item[Způsobuje:] Implementace SVG Tiny podle verze 1.1; verze 1.2 už problém řeší.\footnote{Část specifikace SVG Tiny zabývající se skriptováním je pro verzi 1.1 dostupná na \cite[\texttt{/\#sec-scripting}]{SvgTiny11Doc} a verzi 1.2 na \cite[\texttt{/script.html}]{SvgTiny12Doc}.}
% \item[Týká se:] Prohlížečů s implementací SVG nižší, než 1.2.
% \item[Řešení:] Žádné nenalezeno, lze použít předgenerované obrázky (a zabrat více místa).
% \item[Závažnost:] Střední.
% \end{description*}
% 
% \subsection{Prohlížeč neumí otevřít lokálně uložené SVGZ}
% \begin{description*}
% \item[Problém:] Prohlížeč neumí otevřít lokálně uložený komprimovaný SVG obrázek.\footnote{V hlavičce požadavku se neobjeví, že se jedná o komprimovaný soubor. Viz \cite{SvgzFirefox}.}
% \item[Způsobuje:] Chyba v prohlížeči.
% \item[Týká se:] Mozilla Firefox.
% \item[Řešení:] Žádné nenalezeno, lze obejít použitím obrázků bez komprimace.
% \item[Závažnost:] Střední.
% \end{description*}
