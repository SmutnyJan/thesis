% (g) Popis metodiky testování a jeho výsledky.
% (h) Srovnání s podobnými implementacemi (pokud existují).

\chapter{Testování}
Testování (\textit{testing}) provázelo vzniklé aplikace po celou dobu vývoje -- od evaluece požadavků na počátku, až po akceptační testy na konci. Testování probíhala, byť v jinou dobu, obdobně u serverové i mobilní aplikace, pro větší přehlednost jejich popis tedy sloučím.

\section{Funkční testování}

\subsection{Testování programátorem}
\todo{Kód jsem opětovně revidoval a opravoval chyby. Testování vstupů. Review...}

\todo{Kód jsem opětovně revidoval a opravoval chyby.}
% nefungující SPARQL v Chrome - špatný parametr accepts (místo {json: 'application/json'} pouze 'application/json')
% zbytečné zelenění

\subsection{Testování funkcionalit}
\todo{Splnění požadavků bylo testováno mnou i vedoucím práce.}

\subsection{Integrační testování}
Integrační testování (\textit{integration testing}) bylo prováděno u všech vyvíjených aplikací. Po přidání nové funkcionality byla vždy příslušná část aplikace důkladně otestována, aby bylo zamezeno situacím, kdy nově zanesené úpravy poškodí již existující funkcionality aplikace -- takto vzniklé a neošetřené chyby totiž bývají velmi záludné -- vývojář otestoval všechny části, nenalezl v nich žádný problém, takže je považuje za korektní, možnost chyb daných integrací ho nenapadne a při pozdějším výskytu problému pak hledá řešení na špatných místech, protože skutečné místo považuje za již důkladně otestované.

\subsection{Akceptační testování}
\todo{Bylo prováděno i vedoucím práce.}

\section{Nefunkční testování}


\subsection{Testování kompatibility}
\label{sec:test:compat}
Testování kompatibility (\textit{compatibility testing}) je proces ověřující správný chod systému v různých prostředích -- zařízeních, operačních systémech, běhových prostředích\dots Serverová aplikace je nasazena na konkrétním serveru a s častým přemisťováním se nepočítá, věnovat se proto budu v této sekci pouze mobilní aplikaci, která je na tom přesně opačně -- bude nasazena na zařízeních uživatelů, která jsou vzájemně dosti odlišná.

Testování bylo v omezeném počtu prohlížečů prováděno po celou dobu vývoje, ve zbylých až v době finalizace. Testovalo se v prohlížečích:
\begin{itemize}
 \item Mozilla Firefox (\url{http://www.mozilla.org/firefox/}).
 \item Chromium (\url{http://chromium.org/}).\footnote{Chromium je základem prohlížeče Google Chrome, dá se tedy předpokládat, že ten bude aplikaci podporovat na stejné úrovni.}
 \item rekonq (\url{http://rekonq.kde.org/}).
 \item Konqueror (\url{http://www.konqueror.org/}).
 \item Internet Explorer (\url{http://ie.microsoft.com/}).
 \item Prohlížeč platformy Android (\url{http://android.com/}) -- verze 2 a 4.
 \item Opera Mobile (\url{http://www.opera.com/mobile/}).
 \item Opera Mini (\url{http://www.opera.com/mini/}).
 \item Internet Explorer Mobile (\url{http://www.microsoft.com/windowsphone/en-us/features/default.aspx#internet-explorer}).
\end{itemize}
Mimo výše uvedených navíc nabídl pan inženýr Havryluk, vedoucí práce, otestování v následujících prohlížečích:
\begin{itemize}
 \item Google Chrome for Android (\url{https://www.google.com/intl/en/chrome/android/}).
 \item Prohlížeč platformy Android (\url{http://android.com/}) -- verze 3.
%  \item Dolphin Browser (\url{http://dolphin-browser.com/}).
%  \item Nokia Browser for Symbian  (\url{http://browser.nokia.com/}).
%  \item Prohlížeč platformy BlackBerry (\url{http://us.blackberry.com/smartphones/features/internet.jsp}).
%  \item Safari (\url{http://www.apple.com/safari/}).
\end{itemize}

V následující části jsou popsány nalezené problémy jednotlivých prohlížečů, pokud není uvedené jinak, aktuálních verzí:

\subsubsection{Mozilla Firefox}
Mozilla Firefox po pozměnění vynucuje překreslení \glsname{SVG}, které je navíc poměrně pomalé, snažil jsem se proto algoritmy upravit tak, aby \glsname{SVG} zbytečně nepozměňovaly. Jinak vše funguje, jak má.

\subsubsection{Chromium}
Nelze nastavit transformaci \glsname{SVG} elementu, problém ale lze obejít méně elegantním způsobem. Vše funguje, jak má.

\subsubsection{rekonq}
Prohlížeč nepodporuje geolokační \glsname{API}, takže nelze určit polohu uživalete. Prohlížeč také výchozím fontem zobrazuje velmi úzké bílé znaky, takže nemusí být tolik přehledné formátování například ve \glsname{SPARQL} konzoli. Jinak vše funguje, jak má.

\subsubsection{Konqueror}
Prohlížeč ve výchozím \textit{renderovacím} jádru, KHTML, nepodporuje přímé vkládání \glsname{SVG} do \glsname{HTML}, nefunguje v něm tedy navigace -- uživatel je na toto omezení upozorněn. Jinak vše funguje, jak má.

\subsubsection{Internet Explorer}
Do verze 9 neměl Internet Explorer bez přidaných rozšíření dostatečnou podporu \glsname{SVG} a nepodporoval tak navigaci; od verze 9, včetně, je vše v pořádku. V tomto prohlížeči jsem také narazil na chybu ve specifikaci JavaScriptu: není zde povoleno pojmenovat vlastnost objektu rezervovaným slovem \texttt{default}, což by mělo být zakázané pouze na místech označených jako \textit{Identifiers}, nikoliv tedy jako \textit{Identifier Names} \cite{JsIdentifiers}, přejmenování proměnné zde problém vyřešilo. Jinak vše funguje, jak má.

\subsubsection{Opera}
V Opeře se při vyhledávání v rámci navigace nezobrazovaly objekty uvnitř budov, nejprve jsem z toho velmi chybně vinil špatnou implementaci průhlednosti,\footnote{Nejprve jsem se s tímto problémem setkal u Opera Mobile, kde by to bylo pochopitelné.} po dlouhém zkoumání jsem ale zjistil, že Opera nedokáže v některých případech vlivem odlišného \glsname{DOM} \glsname{SVG} pracovat přímo se třídami \glsname{SVG} elementů, ale musí se k jejich hodnotám v \glsname{DOM} přistupovat skrze delší cestu -- většina ostatních prohlížečů si s tímto problémem poradila. Problematické algoritmy byly přepracovány a problém odstraněn. Vše funguje, jak má.

\subsubsection{Prohlížeč platformy Android}
Do verze 2, včetně, nepodporuje prohlížeč \glsname{SVG} -- tudíž nefunguje navigace, to se ale ve verzích 3 a 4 změnilo a podpora celé aplikace je tak bezproblémová. Vše funguje, jak má.

\subsubsection{Opera Mobile}
V Opeře Mobile se vyskytoval stejný problém, jaký byl odhalen u \textit{desktopové} verze -- nezobrazovaly se objekty uvnitř budov. Odstraněním problému v \textit{desktopové} verzi byl odstraněn i zde. Vše funguje, jak má.

\subsubsection{Opera Mini}
Prohlížeč Opera Mini nepodporuje přímé vkládání \glsname{SVG} do \glsname{HTML}, nefunguje v něm tedy navigace -- uživatel je na toto omezení upozorněn. Také tento prohlížeč nedokáže zobrazit tabulátor v textových polích, například ve \glsname{SPARQL} konzoli -- byly tedy nahrazeny za mezery. Jinak vše funguje, jak má.

\subsubsection{Internet Explorer Mobile}
Testována byla pouze verze 6, v té ještě nebyla přidána podpora \glsname{SVG}, která je již v aktuální verzi přítomná -- v testované verzi tedy nefunguje navigace. Také se zde projevovala, jako v \textit{desktopové} verzi, již opravená, chybná implementace omezení rezervovaných slov. Jinak vše funguje, jak má.

\subsubsection{Google Chrome for Android}
Google Chrome for Android je teprve v betaverzi a některé věci tak ještě nejsou úplně odladěné. V aplikaci se projevila chyba, jinak velmi užitečné, funkce pro automatické přibližování v reakci na stisknutí odkazu -- uživateli je tak usnadněno jeho finální potvrzení, aniž by byl omylem aktivován jiný odkaz v blízkosti zamýšleného. Zdá se, že jinak vše funguje, jak má.


\subsection{Zátěžové testování}
Zátěžové testování (\textit{stress testing}) je součástí výkonnostního testování (\textit{performance testing})
\todo{Má u mobilní smysl? Proxy? SPARQL?}

\subsection{Testování použitelnosti}
Na použitelnost (\textit{usability}) byl kladen důraz hlavně v případě mobilní aplikace, u serverové jsem se naopak použitelností příliš nezabýval -- nemá obsluhu, případně zaškoleného správce. Testování použitelnosti (\textit{usability testing}) bylo prováděno po celou dobu vývoje, formalizovaně ale až těsně před jeho dokončením, aby byla finální aplikace k uživatelům co nejpřívětivější.

\subsubsection{Charakteristika testu}
Testování probíhalo na čtyřech osobách podle následujícího scénáře: Účastníkovi byla předložena mobilní aplikace a byl mu ponechán čas na zběžné seznámení. V případě, že měl účastník vlastní vhodné zařízení, testování probíhalo na něm, jinak mu bylo poskytnuto jiné včetně pomoci s ovládáním, aby nebyly výsledky testu zbytečně zkreslovány. Poté byly účastníkovi zadány následující čtyři úkoly pokrývající předpokládané využití aplikace:
\begin{enumerate}
 \item[UT1] Vyhledejte pozici budovy T9. Úloha sleduje orientaci v základní struktuře aplikace.
 \item[UT2] Vyhledejte jídelníček menzy Masarykova kolej. Úloha sleduje schopnost využít průvodce.
 \item[UT3] Nacházíte se u vchodu to budovy T9, najděte nejbližší občerstvení. Úloha sleduje pokročilou obsluhu navigace.
 \item[UT4] Zjistěte si podrobnosti libovolného problému prostřednictvím \glsname{SPARQL} dotazu. Úloha sleduje schopnost využití \glsname{SPARQL} konzole.
\end{enumerate}
Po celou dobu byla osoba pozorována a po dokončení úkolů s ní byla provedena evaluace. Testování přineslo velký počet podnětů, které byly následně realizovány.

\subsubsection{Charakteristika účastníků}
Testování použitelnosti bylo provedeno na čtyřech účastnících charakterizovaných v tabulce \ref{tab:charakteristikaUcastniku}. % role účastníků
\begin{table}
\begin{center}
\begin{threeparttable}
\begin{tabular}{|c|c|c|c|c|}
\hline
\textbf{Osoba} & \textbf{Věk} & \textbf{Pohlaví} & \textbf{Povolání} & \parbox{2.2in}{\smallskip\textbf{Zkušenosti s počítačem, s~mobilním zařízením}\smallskip} \\
\hline
\textbf{P01} & 25 & žena & výzkum & \parbox{2.2in}{\smallskip pokročilá uživatelka, mírně pokročilá\smallskip} \\
\textbf{P02} & 23 & žena & studentka & \parbox{2.2in}{\smallskip pokročilá uživatelka, bez zkušeností\smallskip} \\
\textbf{P03} & 21 & muž & student & \parbox{2.2in}{\smallskip mírně pokročilý uživatel, bez zkušeností\smallskip} \\
\textbf{P04} & 21 & žena & studentka & \parbox{2.2in}{\smallskip občasná uživatelka, pokročilá\smallskip} \\
\hline
\end{tabular}
\caption{Charakteristika účastníků testování použitelnosti}
\label{tab:charakteristikaUcastniku}
\end{threeparttable}
\end{center}
\end{table}

\subsubsection{Průběh testu}
Osoby v tabulce \ref{tab:charakteristikaUcastniku} charakterizující účastníky testování jsou seřazeny chronologicky. Mezi jednotlivými testy byly ponechány krátké rozestupy, ve kterých jsem analyzoval jejich průběh a snažil se odstranit alespoň některé nalezené problémy -- jednotlivé průběhy tedy mezi sebou nelze příliš porovnávat.
\subsubsection*{P01}
\paragraph*{UT1}
Nejprve se snaží nalézt cestu k budově v sekci \textit{Průvodce}, po projití si ale uvědomuje, že by měla hledat v sekci \textit{Navigace} -- zpočátku ji považovala za mapu stránek. Poté hledaný objekt vyhledává posunem mapy.
\paragraph*{UT2}
Nalézá bez sebemenších problémů.
\paragraph*{UT3}
Snaží se nalézt občerstvení na mapě, nenalézá, přechází do sekce \textit{Průvodce}, opět nenalézá vrací se do \textit{Navigace}, ve vyhledávání zadává slovo \textit{bufet} a nalézá, pouze chvíli nevidí na mapě -- velmi malé a nevycentrované.
\paragraph*{UT4}
Nezná syntaxi dotazovacího jazyka \glsname{SPARQL}, prohlíží si ukázkový dotaz a vykonává ho.
\paragraph*{Poznámky}
Při pohybu na rozsáhlé úvodní stránce (nechala zobrazit příliš mnoho informací) se ztrácí v obsahu, nedaří se jí se jednoduše dostat nahoru k ovládání. Nečte nápovědu. Nevyužívá zpočátku vyhledávání u mapy.

\subsubsection*{P02}
\paragraph*{UT1}
Zpočátku ji nenapadá hledat v sekci \textit{Navigace}, vzápětí se tam ale přesouvá a budovu pohybem po mapě nalézá.
\paragraph*{UT2}
Nalézá bez sebemenších problémů.
\paragraph*{UT3}
Přechází do navigace, prochází mapou, občerstvení nenachází, zkouší ho proto vyhledat a nyní ho už nachází.
\paragraph*{UT4}
Nalézá záložku \glsname{SPARQL} a vykonává ukázkový dotaz, více se o \glsname{SPARQL} nezajímá.
\paragraph*{Poznámky}
Nečte nápovědu. Nevyužívá vyhledávání u mapy.

\subsubsection*{P03}
\paragraph*{UT1}
Ihned vstupuje do sekce \textit{Navigace}, mapou ale prochází manuálně, tlačítky -- ovládání gesty nezaregistruje. Nalézá.
\paragraph*{UT2}
Nalézá bez sebemenších problémů.
\paragraph*{UT3}
Přechází mezi sekcemi \textit{Navigace} a \textit{Průvodce}, nakonec používá vyhledávání, ve kterém nejprve zadává slovo \textit{vobčerstvení}, nakonec ale uznává, že použití slova \textit{občerstvení} bude mít větší šanci na úspěch a nalézá.
\paragraph*{UT4}
Vykonává předpřipravený dotaz a dále se o \glsname{SPARQL} nezajímá.

\subsubsection*{P04}
\paragraph*{UT1}
Sekci \textit{Navigace} nalézá okamžitě, budovu vyhledává, není si ale hned jistá, co je je výsledkem -- v mapě se nezobrazilo překrytí okolí vyhledaného místa. 
\paragraph*{UT2}
Nalézá bez sebemenších problémů.
\paragraph*{UT3}
Občerstvení nalézá ihned, dále zkouší vyhledat slova \textit{bufet} a \textit{jídlo} a na obě také nalézá výsledky.
\paragraph*{UT4}
Vykonává předpřipravený dotaz a dále se o \glsname{SPARQL} nezajímá.

\subsubsection{Shrnutí testu}
Testování použitelnosti přineslo mnoho konstruktivních podnětů k vylepšení aplikace, naprostá většina se jich týkala navigace. Patří mezi ně především:
\subsubsection*{Motivovat k přečtení nápovědy}
Je vhodné motivovat uživatele k přečtení krátké nápovědy vysvětlující základní principy práce s aplikací. Všem účastníkům testování by to velmi prospělo. Může tak být učiněno například na webové stránce nabízející aplikaci ke stažení.
\subsubsection*{Našeptávání}
V průběhu testů použitelnosti byl na základě zpětné vazby od uživatelů realizován podstatně lepší vyhledávací algoritmus s našeptáváním.
\subsubsection*{Zvětšení vstupního pole navigace}
Vstupní pole vyhledávacího pole navigace bylo zvětšeno na základě dvou postřehů vyvstalých při testování použitelnosti: Pole bylo málo výrazné, takže uživatelé vyhledávání přehlíželi a bylo poměrně malé, takže se do něj na dotykových zařízeních špatně trefovalo prstem.
\subsubsection*{Odřezání bílých znaků z okolí dotazu}
V průběhu testování byl několikrát nevědomky zadán k vyhledání výraz, který předcházel nebo následoval bílý znak, tudíž neodpovídal tomu v databázi, takže nebylo nic nalezeno. Problém jsem se rozhodl řešit odstraněním takových znaků.
\subsubsection*{Přesun na nalezené objekty}
Zpočátku uživatelé nezaregistrovávali nalezení hledaného objektu -- pouhé zobrazení šipky někde na mapě nebylo dostatečné. Implementoval jsem proto algoritmus pro přesun na vyhledávané místo a následné přeškálování mapy tak, aby byl zobrazen hledaný objekt i jeho okolí.
\subsubsection*{Odebrání tlačítka Centrovat}
Tlačítko pro vycentrování mapy se po přidání předchozí funkce ukázalo jako zbytečné -- uživatelé se už nemuseli při neúspěšném hledání nalezeného objektu vracet na původní místo, aby to zkusili od začátku, ale vyhledávaný objekt jim byl automaticky vycentrován.
\subsubsection*{Nápověda k regulárním výrazům}
Původně v nápovědě nebyla žádná zmínka o regulárních výrazech a jejich užití, ukázalo se to jako potřebné, proto byla přidána.
% \subsubsection*{Fixní zobrazení menu}
% \subsubsection*{Legenda}


\subsection{Srovnávací testování}
Srovnávací testování (\textit{comparative testing}) proběhlo pouze velmi zběžně -- neexistuje pravděpodobně totiž žádný jiný systém mající podobně specifické cíle. Pro potřeby testování jsem proto systém rozdělil na jednotlivé části tak, jak byly vyvíjeny -- serverovou a mobilní aplikaci. V případě serverové aplikace se mi nepodařilo objevit žádný konkurenční systém, na poli mobilních aplikací jich několik doménou obdobných již je, přesto je každá zaměřena na něco jiného.

Porovnávány byly aplikace Průvodce ČVUT FEL (\url{http://lr.czechian.net/j2me/}) a Studentův průvodce po fakultě (\url{http://webdev.felk.cvut.cz/~molnaja2/}). Je vhodné podotknout, že data první ze jmenovaných aplikací dávno pozbyla na platnosti a pro druhou aplikaci podklady pokrývající celou doménu ani nebyly vytvořeny. Za porovnání by určitě stály i vznikající aplikace z projektu ČVUT navigátor (\url{http://navigator.fit.cvut.cz/}), ty ale stále nejsou zveřejněny.

Vzhledem k výše uvedeným důvodům nebyla pro srovnání stanovena řádná metrika, ale je ponecháno na interpretovi, aby si z nalezených rozdílů vyvodil pro své potřeby patřičné závěry. Výsledky srovnání se nacházejí v tabulce \ref{tab:srovnaniReseni}.

\newcommand{\td}[1]{\parbox{0.24\textwidth}{\smallskip\begin{center}#1\end{center}\smallskip}}
\newcommand{\tdh}[1]{\parbox{0.18\textwidth}{\smallskip\textbf{#1}\smallskip}}
\definecolor{dark}{RGB}{50,50,50}
\begin{table}
\begin{center}
\begin{threeparttable}
\begin{tabular}{|l|c|c|c|}
\hline
\tdh{Charak\-te\-ristika} & \tdh{Průvodce ČVUT FEL} & \tdh{Studentův průvodce po fakultě} & \tdh{Průvodce FIT ČVUT} \\
\hline
\tdh{Technologie} & \td{J2ME} & \td{XHTML, ECMAScript\dots} & HTML5 \\
\tdh{Platformy} & \td{Všechny s~Java~ME} & \td{Všechny s~webovým prohlížečem} & \td{Všechny s~lepším webovým prohlížečem} \\
\tdh{Stav vývoje} & \td{Předčasně ukončený 2006} & \td{Ukončený 2010} & \td{Ukončený 2010} \\
\tdh{Podklady} & \td{Jiné\tnote{a}} & \td{Jiné, malé\tnote{b}} & \td{Dostatečné\tnote{c}} \\
\tdh{Velikost (KB)} & \td{30} & \td{1900\tnote{d}} & \td{340\tnote{d}} \\
\tdh{Licence} & \td{Freeware} & \td{\glsname{GNU}/\glsname{GPL}v3} & \td{\glsname{GNU}/\glsname{GPL}v3} \\
\tdh{Průvodce} & \td{Navigace, dopravní spojení} & \td{Navigace} & \td{Navigace, studium, menzy, kontakty\dots} \\
\tdh{\color{dark}Objekty\linebreak navigace} & \td{Budovy, místnosti} & \td{Místnosti, body zájmu\tnote{e}} & \td{Budovy, místnosti, body zájmu\tnote{e}} \\
\tdh{\color{dark}Vyhledávání objektů} & \td{Označení místnosti} & \td{Označení místnosti, staré označení, zažitý název, jméno vyučujícího} & \td{Označení místnosti/budovy, neoficiální označení, body zájmu} \\
\tdh{\color{dark}Možnosti navigace} & \td{Popis, obrys budovy} & \td{Plán podlaží, RegEx\tnote{f}} & \td{Plán kampusu/podlaží, aktuální pozice, RegEx\tnote{f}} \\
\tdh{Další\linebreak vlastnosti} &  & Nápověda & \td{Nápověda, \glsname{SPARQL} konzole} \\
\hline
\end{tabular}
\begin{tablenotes}
 \item[a] Neaktuální. Budovy \glsname{FEL} \glsname{CVUT} -- T2, Z2, Z4, KN:E\dots
 \item[b] Pouze vzorek -- první a druhé podlaží na Karlově náměstí.
 \item[c] Rozsáhlý vzorek -- dejvický kampus nahrubo a první a třetí podlaží budovy T9 dopodrobna.
 \item[d] Velikost je brána z aktuálního stavu, s kompletními podklady naroste.
 \item[e] Občerstvení, toalety, výtahy\dots
 \item[f] Regulární výraz.
\end{tablenotes}
\caption{Srovnání s ostatními mobilními aplikacemi}
\label{tab:srovnaniReseni}
\end{threeparttable}
\end{center}
\end{table}
